<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>台灣電話號碼簡易驗證</title>
<style>
body{
background-color: #F0F0F0;
text-align: center;
margin: 0;
}
header{
padding: 1em;
}
h1{
font-weight: normal;
margin: 0;
}
content > div{
background-color: #FFF;
padding-bottom: 1.2em;
}
#output{
width: 75%;
margin: 0 auto;
min-height: 1.2em;
}
.or{
color: #AAA;
font-size: 0.6em;
}
.loc > input{
border: none;
margin: 0;
}
.blue{
background-color: #DAE3F2;
}
footer{
width: 100%;
z-index: -1;
font-size: 1em;
color: #CCC;
font-family: 'Yanone Kaffeesatz', sans-serif;
}

</style>
<link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ember.js/1.9.1/ember.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ember-data.js/1.0.0-beta.14.1/ember-data.min.js"></script>
</head>
<body>

<header><h1>國內電話號碼簡易驗證</h1></header>
<content id="content"></content>
<footer>Created by xNedKx</footer>

<script type="text/x-handlebars" data-template-name="index">
<div id="output">{{{output}}}</div>
<div>{{input maxlength="16" id="input" placeholder="請在此處輸入號碼" value=inp}}</div>
<div class="loc">{{#each d in model}}
<input {{bind-attr value=d.predict placeholder=d.n x=check class="d.predict:blue"}} disabled><br>
{{/each}}</div>
</script>

<script>
(function(){

var Reap = Ember.Application.create({
rootElement: "#content"
});

Reap.IndexRoute = Ember.Route.extend({
  model: function() {
    return this.store.find('data');
  }
});

Reap.IndexController = Ember.Controller.extend({
  inp: '',
  output: '',
  check: function(){
    var inp = (this.get('inp')||'').replace(/-/g, '').replace(/^\+?886/, '0').replace(/^\+?88?/, ''), self = this;
    this.store.find('data').then(function(d){
        var chance = [], mn = false, f;
        d.forEach(function(d,i,self){
            d.set('inp',inp);
            if(d.get('predict')){
                chance.push(d.get('predict'));
                if(d.get('nle')){
                    mn = true;
                }
            }
        });
        if(chance.length && inp.length > 1){
            self.set('output', chance.join('<span class="or"> 或 </span>') + (mn?' (號碼數不足)':''));
        }else if(inp.length < 2){
            self.set('output', '');
        }else{
            self.set('output', '不符市話/行動號碼規範');
        }
    });
    return inp;
  }.property('inp')
});

Reap.ApplicationAdapter = DS.FixtureAdapter.extend();
Reap.Data = DS.Model.extend({
r: DS.attr('string'),
f: DS.attr('string'),
n: DS.attr('string'),
d: DS.attr('string'),
re: function(){
    return new RegExp(this.get('r'))
}.property('r'),
inp: DS.attr('string'),
predict: function(){
    var input = (this.get('inp')||''), inp = input, l = input.length, f = this.get('f'), n = this.get('n'), re = this.get('re'), notValid = "";
    if(l == f.length){
        if(input.match(re)){return n}
    }else if(l < f.length){
        for(var j =0; j < l; j++){
            switch(f[j]){
            case 'h':
                if(input[j] != "0"){return notValid}
            break;
            case 'f':
                while(inp.length < f.length){inp += '0'}
                if(!inp.match(re)){return notValid}
            break;
            case 'x':
            case 'd':
                if(isNaN(input[j])){return notValid}
            break;
            default:
                if(input[j] != f[j]){return notValid}
            }
        }
        return n;
    }
    return notValid;
}.property('inp'),
nle: function(){
    return this.get('inp').length < this.get('f').replace(/x/g,'').length;
}.property('inp')
});

function r2s(reg){return reg.toString().replace('\+','\\+').replace(/\//g,'');}

Reap.Data.FIXTURES = [
{
id: 1,
r: r2s(/^(?:\+?886|0)2[2358]\d{7}$/),
f: "h2fddddddd",
n: "臺北市、新北市及基隆市",
d: "02-0000-0000"
},
{
id: 2,
r: r2s(/^(?:\+?886|0)3[2-4]\d{6}$/),
f: "h3fdddddd",
n: "桃園縣",
d: "03-000-0000"
},
{
id: 3,
r: r2s(/^(?:\+?886|0)3[56]\d{6}$/),
f: "h3fdddddd",
n: "新竹縣市",
d: "03-000-0000"
},
{
id: 4,
r: r2s(/^(?:\+?886|0)37[2-9]\d{5}$/),
f: "h37fddddd",
n: "苗栗縣",
d: "037-000-000"
},
{
id: 5,
r: r2s(/^(?:\+?886|0)38\d{6}$/),
f: "h38dddddd",
n: "花蓮縣",
d: "038-000-000"
},
{
id: 6,
r: r2s(/^(?:\+?886|0)39\d{6}$/),
f: "h39dddddd",
n: "宜蘭縣",
d: "039-000-000"
},
{
id: 7,
r: r2s(/^(?:\+?886|0)4[23]\d{7}$/),
f: "h4fddddddd",
n: "臺中市",
d: "04-0000-0000"
},
{
id: 8,
r: r2s(/^(?:\+?886|0)4[78]\d{6}$/),
f: "h4fdddddd",
n: "彰化縣",
d: "04-000-0000"
},
{
id: 9,
r: r2s(/^(?:\+?886|0)49[2-9]\d{6}$/),
f: "h49fdddddd",
n: "南投縣",
d: "049-000-0000"
},
{
id: 10,
r: r2s(/^(?:\+?886|0)5[2-4]\d{6}$/),
f: "h5fdddddd",
n: "嘉義縣市",
d: "05-000-0000"
},
{
id: 11,
r: r2s(/^(?:\+?886|0)5[5-7]\d{6}$/),
f: "h5fdddddd",
n: "雲林縣",
d: "05-000-0000"
},
{
id: 12,
r: r2s(/^(?:\+?886|0)6[235-7]\d{6}$/),
f: "h6fdddddd",
n: "臺南市",
d: "06-000-0000"
},
{
id: 13,
r: r2s(/^(?:\+?886|0)69\d{6}$/),
f: "h69dddddd",
n: "澎湖縣",
d: "069-000-000"
},
{
id: 14,
r: r2s(/^(?:\+?886|0)7[2-9]\d{6}$/),
f: "h7fdddddd",
n: "高雄市",
d: "07-000-0000"
},
{
id: 15,
r: r2s(/^(?:\+?886|0)82[2-57-9]\d{5}$/),
f: "h82fddddd",
n: "金門",
d: "082-000-000"
},
{
id: 16,
r: r2s(/^(?:\+?886|0)826\d{5}$/),
f: "h826ddddd",
n: "烏坵",
d: "0826-00-000"
},
{
id: 17,
r: r2s(/^(?:\+?886|0)836\d{5}$/),
f: "h836ddddd",
n: "馬祖",
d: "0836-00-000"
},
{
id: 18,
r: r2s(/^(?:\+?886|0)8[478]\d{6}$/),
f: "h8fdddddd",
n: "屏東縣",
d: "08-000-0000"
},
{
id: 19,
r: r2s(/^(?:\+?886|0)89[2-9]\d{5}$/),
f: "h89fddddd",
n: "臺東縣",
d: "089-000-000"
},
{
id: 20,
r: r2s(/^(?:\+?886|0)8[56]\d{7}$/),
f: "h8fddddddd",
n: "行動-08",
d: "0800-000-000"
},
{
id: 21,
r: r2s(/^(?:\+?886|0)9[0-8]\d{7}$/),
f: "h9fddddddd",
n: "行動-09",
d: "0900-000-000"
},
{
id: 22,
r: r2s(/^(?:\+?886|0)99\d{7}$/),
f: "h99ddddddd",
n: "個人",
d: "0990-000-000"
},
{
id: 23,
r: r2s(/^(?:\+?886|0)20\d{5,7}$/),
f: "h20dddddxx",
n: "付費",
d: "0200-0000|020-000-000|0200-000-000"
},
{
id: 24,
r: r2s(/^(?:\+?886|0)50\d{5,7}$/),
f: "h50dddddxx",
n: "一般費率(?)",
d: "0500-0000|050-000-000|0500-000-000"
},
{
id: 25,
r: r2s(/^(?:\+?886|0)80\d{5,7}$/),
f: "h80dddddxx",
n: "免費",
d: "0800-0000|080-000-000|0800-000-000"
}
];

/*var pnRe = /^(?:\+?886|0)(?:(?:(?:2[2358]|4[23]|8[56]|9[0-9])\d{7})|(?:(?:3[2-689]|4(?:[78]|9[2-9])|5[2-7]|6[235-9]|7[2-9]|8[478])\d{6})|(?:(?:37[2-9]|8(?:2[2-9]|36|9[2-9]))\d{5}))$/;
function pnValid(str){
    if(typeof str != 'string'){throw 'pnValid needs input to be a string.'}
    var r = str.replace(/-/g, '').match(pnRe);
    return r? r[0] : null;
}*/

})();
</script>

</body>
</html>