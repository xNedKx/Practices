var P5g=function(e){function t(e,t){var a=e+t*f;y+1>C?a>=0&&y>a&&0===b[a]&&(b[a]=C,w[C-1]=a,n(e,t),r(),C+=1):void 0===h?i():o(pl)}function n(e,t){var n,r=e+t*f,o=L;0===e?(o&=~O,x[r]|=U|j|B|q|G|K):e===f-1&&(o&=~N,x[r]|=M|_|T|z|J|S),0===t?(o&=~F,x[r]|=B|A|M|K|I|z):t===E-1&&(o&=~P,x[r]|=T|H|U|S|D|q),o&F&&(n=r-f,b[n]&&(x[r]|=A,x[n]|=H,(b[r]-b[n])%2&&(x[r]|=I,x[n]|=D))),o&(F|N)&&(n=r-f+1,b[n]&&(x[r]|=M,x[n]|=U,(b[r]-b[n])%2&&(x[r]|=z,x[n]|=q))),o&N&&(n=r+1,b[n]&&(x[r]|=_,x[n]|=j,(b[r]-b[n])%2&&(x[r]|=J,x[n]|=G))),o&(N|P)&&(n=r+1+f,b[n]&&(x[r]|=T,x[n]|=B,(b[r]-b[n])%2&&(x[r]|=S,x[n]|=K))),o&P&&(n=r+f,b[n]&&(x[r]|=H,x[n]|=A,(b[r]-b[n])%2&&(x[r]|=D,x[n]|=I))),o&(P|O)&&(n=r+f-1,b[n]&&(x[r]|=U,x[n]|=M,(b[r]-b[n])%2&&(x[r]|=q,x[n]|=z))),o&O&&(n=r-1,b[n]&&(x[r]|=j,x[n]|=_,(b[r]-b[n])%2&&(x[r]|=G,x[n]|=J))),o&(O|F)&&(n=r-1-f,b[n]&&(x[r]|=B,x[n]|=T,(b[r]-b[n])%2&&(x[r]|=K,x[n]|=S)))}function r(){if(C===y)i();else{for(var e={},t={},n={},r="",a=0,c=0;C>c;c++){for(var l=w[c],d=l,s=[[],[],[],[],[],[],[],[]];x[d]&A&&!(x[d]&I);)d-=f,s[7].push(d);for(d=l;x[d]&M&&!(x[d]&z);)d=d-f+1,s[6].push(d);for(d=l;x[d]&_&&!(x[d]&J);)d+=1,s[5].push(d);for(d=l;x[d]&T&&!(x[d]&S);)d=d+1+f,s[4].push(d);for(d=l;x[d]&H&&!(x[d]&D);)d+=f,s[3].push(d);for(d=l;x[d]&U&&!(x[d]&q);)d=d+f-1,s[2].push(d);for(d=l;x[d]&j&&!(x[d]&G);)d-=1,s[1].push(d);for(d=l;x[d]&B&&!(x[d]&K);)d=d-1-f,s[0].push(d);a=s[0].length+s[4].length+1,r=s[0].reverse().concat(l).concat(s[4]).join(";"),g>a||e.hasOwnProperty(r)?a!==g-1||t.hasOwnProperty(r)?a!==g-2||n.hasOwnProperty(r)||(n[r]=C):t[r]=C:e[r]=C,a=s[1].length+s[5].length+1,r=s[1].reverse().concat(l).concat(s[5]).join(";"),g>a||e.hasOwnProperty(r)?a!==g-1||t.hasOwnProperty(r)?a!==g-2||n.hasOwnProperty(r)||(n[r]=C):t[r]=C:e[r]=C,a=s[6].length+s[2].length+1,r=s[6].reverse().concat(l).concat(s[2]).join(";"),g>a||e.hasOwnProperty(r)?a!==g-1||t.hasOwnProperty(r)?a!==g-2||n.hasOwnProperty(r)||(n[r]=C):t[r]=C:e[r]=C,a=s[7].length+s[3].length+1,r=s[7].reverse().concat(l).concat(s[3]).join(";"),g>a||e.hasOwnProperty(r)?a!==g-1||t.hasOwnProperty(r)?a!==g-2||n.hasOwnProperty(r)||(n[r]=C):t[r]=C:e[r]=C}var p=Object.keys(e),h=Object.keys(t),u=Object.keys(n),m=[];for(c=0;c<p.length;c++)m=p[c].split(";"),m.forEach(function(e){k[e]=m.length});for(c=0;c<h.length;c++)m=h[c].split(";"),m.forEach(function(e){k[e]<g-1&&(k[e]=m.length)});for(c=0;c<u.length;c++)m=u[c].split(";"),m.forEach(function(e){k[e]<g-2&&(k[e]=m.length)});p.length&&o((C-1)%2)}}function o(e){C=y+1,h=e,console.log("Player",e+1,"wins.")}function i(){console.log("Tie")}function a(){return JSON.stringify({w:f,h:E,d:Array.prototype.slice.call(w,0,C-1)})}function c(e){try{var n=JSON.parse(e);l(n.w,n.h);for(var r=0;r<n.d.length;r++){var o=n.d[r]%n.w,i=(n.d[r]-o)/n.w;t(o,i)}}catch(a){console.log(a)}}function l(e,t){e=isFinite(e)?+e:m,t=isFinite(t)?+t:v,f=g+2>e?g+2:e>256?256:e,E=g+2>t?g+2:t>256?256:t,y=f*E,b=new Uint16Array(y),w=new Uint16Array(y),x=new Uint16Array(y),C=1,k=new Uint16Array(y)}function d(){for(var e=document.getElementsByClassName("point"),t=0;C+1>t;t++){var n=w[t];e[n].className+=" p"+((b[n]-1)%2+1),e[n].removeEventListener("click",s),k[n]?k[n]>+e[n].firstChild.innerHTML&&(e[n].firstChild.innerHTML=k[n]):e[n].firstChild.innerHTML=""}if(C>=y+1){for(var t=0;t<e.length;t++)e[t].removeEventListener("click",s);alert(void 0===h?"It`s a tie.":"Player "+(h+1)+" wins.")}document.getElementById("gsc_"+u).innerHTML=".point.active { background-color: "+((C-1)%2?"#E6E6FF":"#FFE6E6")+";}"}function s(e){if(0===e.button){e.preventDefault(),this.removeEventListener("click",s),this.className+=" p"+((C-1)%2+1),this.title=C,t(this.x,this.y);for(var n=document.getElementsByClassName("point"),r=0;r<n.length;r++){var o=n[r].y*f+n[r].x;k[o]?k[o]>+n[r].firstChild.innerHTML&&(n[r].firstChild.className="cir c"+Math.min(k[o],5)):n[r].firstChild.innerHTML="",y+1>C||(n[r].removeEventListener("click",s),n[r].className="point"+n[r].className.substr(12))}document.getElementById("gsc_"+u).innerHTML=".point.active { background-color: "+((C-1)%2?"#E6E6FF":"#FFE6E6")+";}",y+1>C||alert(void 0===h?"It`s a tie.":"Player "+(h+1)+" wins.")}}function p(e,t,n){var r=document.createElement("div"),o=document.createElement("style"),i=document.createElement("style"),a=document.getElementById("gs_"+u),c=document.getElementById("gsc_"+u),d=document.getElementById("dg_"+u);d&&d.parentNode.removeChild(d),a&&a.parentNode.removeChild(a),c&&c.parentNode.removeChild(c),l(t,n),r.id="dg_"+u,o.id="gs_"+u,i.id="gsc_"+u,o.innerHTML="#dg_"+u+" { width: "+22*f+"px; height: "+22*E+"px; display: inline-block; box-sizing: border-box; } .point { background-color: #EEE; width: 20px; height: 20px; float: left; line-height: 20px; font-size: 12px; text-align: center; padding: 1px; position: relative; overflow: hidden; } .point > .cir { width: 20px; height: 20px; border-radius: 10px; z-index: 10; position: absolute; top: 1px; left: 1px; } .point.active>.cir:hover { background-color: #FFF; cursor: pointer; } .p1 > .cir,.p1.active > .cir:hover { background-color: #E6A1A1; cursor: default; box-shadow: inset 0 0 10px rgba(200, 40, 40, 0.6); } .p2 > .cir,.p2.active > .cir:hover { background-color: #A1A1E6; cursor: default; box-shadow: inset 0 0 10px rgba(40, 40, 200, 0.6); } .bo { display: none; position: absolute; width: 15px; height: 15px; box-shadow: inset 0 0 2px #111; } .l1 { display: block; top: -4px; left: -4px; } .l2 { display: block; top: -4px; right: -4px; } .l3 { display: block; bottom: -4px; left: -4px; } .l4 { display: block; bottom: -4px; right: -4px; } .p1 > .cir.c3 { background-color: #E65C5C; } .p1 > .cir.c4 { background-color: #E62E2E; } .p1 > .cir.c5 { background-color: #FE0101; } .p2 > .cir.c3 { background-color: #5C5CE6; } .p2 > .cir.c4 { background-color: #2E2EE6; } .p2 > .cir.c5 { background-color: #0101FE; }",i.innerHTML=".point.active { background-color: "+((C-1)%2?"#E6E6FF":"#FFE6E6")+";}";for(var p=0;E>p;p++){for(var h=document.createElement("div"),g=0;f>g;g++){var m=document.createElement("div");m.className="point active",m.x=g,m.y=p,m.addEventListener("click",s),m.appendChild(document.createElement("div")),m.firstChild.className="cir",m.appendChild(document.createElement("div")),m.lastChild.className="bo"+(0===g||0===p?"":" l1"),m.appendChild(document.createElement("div")),m.lastChild.className="bo"+(g===f-1||0===p?"":" l2"),m.appendChild(document.createElement("div")),m.lastChild.className="bo"+(0===g||p===E-1?"":" l3"),m.appendChild(document.createElement("div")),m.lastChild.className="bo"+(g===f-1||p===E-1?"":" l4"),h.appendChild(m)}h.appendChild(document.createElement("div")),h.lastChild.style.clear="both",r.appendChild(h)}e?e.appendChild(r):document.body.appendChild(r),document.body.appendChild(o),document.body.appendChild(i)}e=void 0===e?{}:{oldP5g:e};var h,u=Math.round(1e7*Math.random()),g=5,m=32,v=32,f=m,E=v,y=f*E,b=new Uint16Array(y),w=new Uint16Array(y),x=new Uint16Array(y),C=1,k=new Uint16Array(y),F=8,N=4,P=2,O=1,L=F|N|P|O,A=32768,M=16384,_=8192,T=4096,H=2048,U=1024,j=512,B=256,I=128,z=64,J=32,S=16,D=8,q=4,G=2,K=1;return e.reset=l,e.save=a,e.load=c,e.refresh_dom=d,e.create_dom=p,e}(P5g);