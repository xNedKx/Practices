var P5g=function(e){function t(e,t){if(isFinite(e)&&isFinite(t)&&e>=0&&x>e&&t>=0&&y>t){var n=e+t*x;w?void 0===g?l():c(g):0===C[n]?(C[n]=N,F[N-1]=n,a(),N+=1,N>k&&(w=!0)):console.log("Unavailable placement.")}else console.log("Unavailable placement.")}function n(e,t,n){if(isFinite(e)&&isFinite(t)&&isFinite(n)&&e>=0&&x>e&&t>=0&&y>t&&n>=0&&n<R.length){for(var i,o=e+t*x,r=U[R[n]],a=Math.min(2*v,1===r.x?x-e:-1===r.x?e+1:1/0,1===r.y?y-t:-1===r.y?t+1:1/0),c=r.x+r.y*x,l=[],s=[],d=-1,p=-1,h=-1,u={o:0,j:0,d:0},f=1;a>f;f++)if(i=o+c*f,0===C[i]){if(-1!==d)break;if(d=f,-1!=p)break}else if(Math.abs(C[i]-C[o])%2===0){if(-1!==p){h=f;break}-1===d?l.push(i):s.push(i)}else if(Math.abs(C[i]-C[o])%2===1){if(-1!==d){s.length>0&&(p=f);break}s.push(i),-1===p&&(p=f)}return f===a&&(-1==d?-1==p?p=f:h=f:s.length>0&&(p=f)),-1!==h?(u.b=1,u.d=1):s.length>0?-1!=p?d>p?u.d=1:(u.o=1,u.j=1,u.b=1):(u.j=1,u.o=1):-1!==p?u.d=1:u.o=1,{p:o,n:l,n2:s,f:u}}}function i(e,t,i){var o,r=n(e,t,i),a=n(e,t,i+4),c=r.n.length+a.n.length+1,l=[r.p].concat(r.n).concat(a.n),s=[];return v>c?r.f.o&&a.f.o?r.f.j&&a.f.j?(o=r.n2.length>a.n2.length?1:r.n2.length<a.n2.length?2:0,2!==o&&s.push(r.f.b?{t:3,n:c+r.n2.length,p:l.concat(r.n2)}:{t:1,n:c+r.n2.length,p:l.concat(r.n2)}),1!==o&&s.push(a.f.b?{t:3,n:c+a.n2.length,p:l.concat(a.n2)}:{t:1,n:c+a.n2.length,p:l.concat(a.n2)})):s.push(r.f.j?r.f.b?{t:3,n:c+r.n2.length,p:l.concat(r.n2)}:{t:1,n:c+r.n2.length,p:l.concat(r.n2)}:a.f.j?a.f.b?{t:3,n:c+a.n2.length,p:l.concat(a.n2)}:{t:1,n:c+a.n2.length,p:l.concat(a.n2)}:{t:0,n:c,p:l}):s.push(r.f.o?r.f.j?r.f.b?{t:5,n:c+r.n2.length,p:l.concat(r.n2)}:{t:3,n:c+r.n2.length,p:l.concat(r.n2)}:{t:3,n:c,p:l}:a.f.o?a.f.j?a.f.b?{t:5,n:c+a.n2.length,p:l.concat(a.n2)}:{t:3,n:c+a.n2.length,p:l.concat(a.n2)}:{t:2,n:c,p:l}:{t:4,n:c,p:l}):s.push({t:0,n:c,p:l}),s}function o(e,t){for(var n=[],o=0;o<D.length;o++)n=n.concat(i(e,t,o)),n.sort(function(e,t){return t.n-e.n||e.t-t.t});for(var r=n.length,a=0;r>a;a++){if(n[a].n>=v)return n[a].t%2?v-1:v;if(n[a].n===v-1){if(4!==n[a].t)return v-1}else{if(n[a].n!==v-2)return n[a].n===v-3?v-3:void 0;if(n[a].t<2)return v-2}}return 0}function r(e,t){for(var n,i,r,a=e+t*x,c=0;c<R.length;c++)for(var l=U[R[c]],s=Math.min(v,1===l.x?x-e:-1===l.x?e+1:1/0,1===l.y?y-t:-1===l.y?t+1:1/0),d=l.x+l.y*x,p=0,h=0,u=1;s>u;u++)if(n=a+d*u,i=e+l.x*u,r=t+l.y*u,0===C[n]){if(h)break;h=u}else if(Math.abs(C[n]-C[a])%2===0){if(p)break;L[n]=o(i,r)}else Math.abs(C[n]-C[a])%2===1&&(p||(p=u),L[n]=o(i,r));L[a]=o(e,t)}function a(){if(N>k)l();else{var e=F[N-1],t=e%x,n=(e-t)/x;r(t,n),L[e]<v?N===k&&l():c((N-1)%2)}}function c(e){w=!0,g=e,console.log("Player",e+1,"wins.")}function l(){w=!0,console.log("Tie")}function s(){return JSON.stringify({w:x,h:y,d:Array.prototype.slice.call(F,0,N-1)})}function d(e){try{var n=JSON.parse(e);p(n.w,n.h);for(var i=0;i<n.d.length;i++){var o=n.d[i]%n.w,r=(n.d[i]-o)/n.w;t(o,r)}}catch(a){console.log(a)}}function p(e,t){e=isFinite(e)?+e:b,t=isFinite(t)?+t:E,x=v+2>e?v+2:e>256?256:e,y=v+2>t?v+2:t>256?256:t,k=x*y,C=new Uint16Array(k),F=new Uint16Array(k),L=new Uint16Array(k),N=1,w=!1}function h(){for(var e=document.getElementsByClassName("point"),t=0;t<e.length;t++){var n=e[t].dataset.p;C[n]&&(e[n].className=e[n].className.substr(0,12)+" p"+((C[n]-1)%2+1),e[n].title=C[n],e[n].removeEventListener("click",u)),e[t].firstChild.className=L[n]>0?"cir c"+Math.min(L[n],5):"cir",w&&(e[t].removeEventListener("click",u),e[t].className="point"+e[t].className.substr(12))}w&&alert(void 0===g?"It`s a tie.":"Player "+(g+1)+" wins."),document.getElementById("gsc_"+m).innerHTML=".point.active { background-color: "+((N-1)%2?"#E6E6FF":"#FFE6E6")+";}"}function u(e){if(0===e.button){e.preventDefault(),this.removeEventListener("click",u),this.className=this.className.substr(0,12)+" p"+((N-1)%2+1),this.title=N,t(+this.dataset.x,+this.dataset.y);for(var n=document.getElementsByClassName("point"),i=0;i<n.length;i++){var o=n[i].dataset.p;n[i].firstChild.className=L[o]>0?"cir c"+Math.min(L[o],5):"cir",w&&(n[i].removeEventListener("click",u),n[i].className="point"+n[i].className.substr(12))}document.getElementById("gsc_"+m).innerHTML=".point.active { background-color: "+((N-1)%2?"#E6E6FF":"#FFE6E6")+";}",w&&alert(void 0===g?"It`s a tie.":"Player "+(g+1)+" wins.")}}function f(e,t,n){var i=document.createElement("div"),o=document.createElement("style"),r=document.createElement("style"),a=document.getElementById("gs_"+m),c=document.getElementById("gsc_"+m),l=document.getElementById("dg_"+m);l&&l.parentNode.removeChild(l),a&&a.parentNode.removeChild(a),c&&c.parentNode.removeChild(c),p(t,n),i.id="dg_"+m,o.id="gs_"+m,r.id="gsc_"+m,o.innerHTML="#dg_"+m+" { width: "+22*x+"px; height: "+22*y+"px; display: inline-block; box-sizing: border-box; } .point { background-color: #EEE; width: 20px; height: 20px; float: left; line-height: 20px; font-size: 12px; text-align: center; padding: 1px; position: relative; overflow: hidden; } .point > .cir { width: 20px; height: 20px; border-radius: 10px; z-index: 10; position: absolute; top: 1px; left: 1px; } .point.active>.cir:hover { background-color: #FFF; cursor: pointer; } .p1 > .cir,.p1.active > .cir:hover { background-color: #E6A1A1; cursor: default; box-shadow: inset 0 0 10px rgba(200, 40, 40, 0.6); } .p2 > .cir,.p2.active > .cir:hover { background-color: #A1A1E6; cursor: default; box-shadow: inset 0 0 10px rgba(40, 40, 200, 0.6); } .bo { display: none; position: absolute; width: 15px; height: 15px; box-shadow: inset 0 0 2px #111; } .l1 { display: block; top: -4px; left: -4px; } .l2 { display: block; top: -4px; right: -4px; } .l3 { display: block; bottom: -4px; left: -4px; } .l4 { display: block; bottom: -4px; right: -4px; } .p1 > .cir.c3,.p1 > .cir.c3:hover { background-color: #E65C5C; } .p1 > .cir.c4,.p1 > .cir.c4:hover { background-color: #E62E2E; } .p1 > .cir.c5,.p1 > .cir.c5:hover { background-color: #FE0101; } .p2 > .cir.c3,.p2 > .cir.c3:hover { background-color: #5C5CE6; } .p2 > .cir.c4,.p2 > .cir.c4:hover { background-color: #2E2EE6; } .p2 > .cir.c5,.p2 > .cir.c5:hover { background-color: #0101FE; }",r.innerHTML=".point.active { background-color: "+((N-1)%2?"#E6E6FF":"#FFE6E6")+";}";for(var s=0;y>s;s++){for(var d=document.createElement("div"),h=0;x>h;h++){var f=document.createElement("div");f.dataset.p=h+s*x,f.className="point active",f.dataset.x=h,f.dataset.y=s,f.addEventListener("click",u),f.appendChild(document.createElement("div")),f.firstChild.className="cir",f.appendChild(document.createElement("div")),f.lastChild.className="bo"+(0===h||0===s?"":" l1"),f.appendChild(document.createElement("div")),f.lastChild.className="bo"+(h===x-1||0===s?"":" l2"),f.appendChild(document.createElement("div")),f.lastChild.className="bo"+(0===h||s===y-1?"":" l3"),f.appendChild(document.createElement("div")),f.lastChild.className="bo"+(h===x-1||s===y-1?"":" l4"),d.appendChild(f)}d.appendChild(document.createElement("div")),d.lastChild.style.clear="both",i.appendChild(d)}i.onmousedown=function(e){e.preventDefault()},e?e.appendChild(i):document.body.appendChild(i),document.body.appendChild(o),document.body.appendChild(r)}e=void 0===e?{}:{oldP5g:e};var g,m=Math.round(1e7*Math.random()),v=5,b=32,E=32,x=b,y=E,k=x*y,C=new Uint16Array(k),F=new Uint16Array(k),N=1,w=!1,L=new Uint16Array(k),U={U:{x:0,y:-1},UR:{x:1,y:-1},R:{x:1,y:0},RD:{x:1,y:1},D:{x:0,y:1},DL:{x:-1,y:1},L:{x:-1,y:0},LU:{x:-1,y:-1}},D=["LU","L","UR","U"],M=["RD","R","DL","D"],R=D.concat(M);return U.U.r=U.D,U.UR.r=U.DL,U.R.r=U.L,U.RD.r=U.LU,U.D.r=U.U,U.DL.r=U.UR,U.L.r=U.R,U.LU.r=U.RD,e.hist=function(){return F},e.map=function(){return C},e.pat=function(){return pat},e.cm=function(){return L},e.place=t,e.reset=p,e.save=s,e.load=d,e.refresh_dom=h,e.create_dom=f,e}(P5g);