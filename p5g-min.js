var P5g=function(e){function t(e,t){if(isFinite(e)&&isFinite(t)&&e>=0&&x>e&&t>=0&&k>t){var n=e+t*x;L?void 0===m?l():c(m):0===F[n]?(F[n]=w,N[w-1]=n,a(),w+=1,w>C&&(L=!0)):console.log("Unavailable placement.")}else console.log("Unavailable placement.")}function n(e,t,n){if(isFinite(e)&&isFinite(t)&&isFinite(n)&&e>=0&&x>e&&t>=0&&k>t&&n>=0&&n<R.length){for(var o,i=e+t*x,r=D[R[n]],a=Math.min(2*b,1===r.x?x-e:-1===r.x?e+1:1/0,1===r.y?k-t:-1===r.y?t+1:1/0),c=r.x+r.y*x,l=[],s=[],d=-1,p=-1,h=-1,u={o:0,j:0,d:0},f=1;a>f;f++)if(o=i+c*f,0===F[o]){if(-1!==d)break;if(d=f,-1!=p)break}else if(Math.abs(F[o]-F[i])%2===0){if(-1!==p){h=f;break}-1===d?l.push(o):s.push(o)}else if(Math.abs(F[o]-F[i])%2===1){if(-1!==d){s.length>0&&(p=f);break}s.push(o),-1===p&&(p=f)}return f===a&&(-1==d?-1==p?p=f:h=f:s.length>0&&(p=f)),-1!==h?(u.b=1,u.d=1):s.length>0?-1!=p?d>p?u.d=1:(u.o=1,u.j=1,u.b=1):(u.j=1,u.o=1):-1!==p?u.d=1:u.o=1,{p:i,n:l,n2:s,f:u}}}function o(e,t,o){var i,r=n(e,t,o),a=n(e,t,o+4),c=r.n.length+a.n.length+1,l=[r.p].concat(r.n).concat(a.n),s=[];return b>c?r.f.o&&a.f.o?r.f.j&&a.f.j?(i=r.n2.length>a.n2.length?1:r.n2.length<a.n2.length?2:0,2!==i&&s.push(r.f.b?{t:3,n:c+r.n2.length,p:l.concat(r.n2)}:{t:1,n:c+r.n2.length,p:l.concat(r.n2)}),1!==i&&s.push(a.f.b?{t:3,n:c+a.n2.length,p:l.concat(a.n2)}:{t:1,n:c+a.n2.length,p:l.concat(a.n2)})):s.push(r.f.j?r.f.b?{t:3,n:c+r.n2.length,p:l.concat(r.n2)}:{t:1,n:c+r.n2.length,p:l.concat(r.n2)}:a.f.j?a.f.b?{t:3,n:c+a.n2.length,p:l.concat(a.n2)}:{t:1,n:c+a.n2.length,p:l.concat(a.n2)}:{t:0,n:c,p:l}):s.push(r.f.o?r.f.j?r.f.b?{t:5,n:c+r.n2.length,p:l.concat(r.n2)}:{t:3,n:c+r.n2.length,p:l.concat(r.n2)}:{t:3,n:c,p:l}:a.f.o?a.f.j?a.f.b?{t:5,n:c+a.n2.length,p:l.concat(a.n2)}:{t:3,n:c+a.n2.length,p:l.concat(a.n2)}:{t:2,n:c,p:l}:{t:4,n:c,p:l}):s.push({t:0,n:c,p:l}),s}function i(e,t){for(var n=[],i=0;i<M.length;i++)n=n.concat(o(e,t,i)),n.sort(function(e,t){return t.n-e.n||e.t-t.t});for(var r=n.length,a=0;r>a;a++){if(n[a].n>=b)return n[a].t%2?b-1:b;if(n[a].n===b-1){if(4!==n[a].t)return b-1}else{if(n[a].n!==b-2)return n[a].n===b-3?b-3:void 0;if(n[a].t<2)return b-2}}return 0}function r(e,t){for(var n,o,r,a=e+t*x,c=0;c<R.length;c++)for(var l=D[R[c]],s=Math.min(b,1===l.x?x-e:-1===l.x?e+1:1/0,1===l.y?k-t:-1===l.y?t+1:1/0),d=l.x+l.y*x,p=0,h=0,u=1;s>u;u++)if(n=a+d*u,o=e+l.x*u,r=t+l.y*u,0===F[n]){if(h)break;h=u}else if(Math.abs(F[n]-F[a])%2===0){if(p)break;U[n]=i(o,r)}else Math.abs(F[n]-F[a])%2===1&&(p||(p=u),U[n]=i(o,r));U[a]=i(e,t)}function a(){if(w>C)l();else{var e=N[w-1],t=e%x,n=(e-t)/x;r(t,n),U[e]<b?w===C&&l():c((w-1)%2)}}function c(e){L=!0,m=e,console.log("Player",e+1,"wins.")}function l(){L=!0,console.log("Tie")}function s(){return JSON.stringify({w:x,h:k,d:Array.prototype.slice.call(N,0,w-1)})}function d(e){try{var n=JSON.parse(e);h(n.w,n.h);for(var o=0;o<n.d.length;o++){var i=n.d[o]%n.w,r=(n.d[o]-i)/n.w;t(i,r)}}catch(a){console.log(a)}}function p(){var e=Array.prototype.slice.call(N,0,w-2),n=x,o=e;h(n,o);for(var i=0;i<e.length;i++){var r=e[i]%x,a=(e[i]-r)/x;t(r,a)}}function h(e,t){e=isFinite(e)?+e:y,t=isFinite(t)?+t:E,x=b+2>e?b+2:e>256?256:e,k=b+2>t?b+2:t>256?256:t,C=x*k,F=new Uint16Array(C),N=new Uint16Array(C),U=new Uint16Array(C),w=1,L=!1}function u(){for(var e=document.getElementsByClassName("point"),t=0;t<e.length;t++){var n=e[t].dataset.p;F[n]&&(e[n].className=e[n].className.substr(0,12)+" p"+((F[n]-1)%2+1),e[n].title=F[n],e[n].removeEventListener("click",f)),e[t].firstChild.className=U[n]>0?"cir c"+Math.min(U[n],5):"cir",L&&(e[t].removeEventListener("click",f),e[t].className="point"+e[t].className.substr(12))}L&&alert(void 0===m?"It`s a tie.":"Player "+(m+1)+" wins."),document.getElementById("gsc_"+v).innerHTML=".point.active { background-color: "+((w-1)%2?"#E6E6FF":"#FFE6E6")+";}"}function f(e){if(0===e.button){e.preventDefault(),this.removeEventListener("click",f),this.className=this.className.substr(0,12)+" p"+((w-1)%2+1),this.title=w,t(+this.dataset.x,+this.dataset.y);for(var n=document.getElementsByClassName("point"),o=0;o<n.length;o++){var i=n[o].dataset.p;n[o].firstChild.className=U[i]>0?"cir c"+Math.min(U[i],5):"cir",L&&(n[o].removeEventListener("click",f),n[o].className="point"+n[o].className.substr(12))}document.getElementById("gsc_"+v).innerHTML=".point.active { background-color: "+((w-1)%2?"#E6E6FF":"#FFE6E6")+";}",L&&alert(void 0===m?"It`s a tie.":"Player "+(m+1)+" wins.")}}function g(e,t,n){var o=document.createElement("div"),i=document.createElement("style"),r=document.createElement("style"),a=document.getElementById("gs_"+v),c=document.getElementById("gsc_"+v),l=document.getElementById("dg_"+v);l&&l.parentNode.removeChild(l),a&&a.parentNode.removeChild(a),c&&c.parentNode.removeChild(c),h(t,n),o.id="dg_"+v,i.id="gs_"+v,r.id="gsc_"+v,i.innerHTML="#dg_"+v+" { width: "+22*x+"px; height: "+22*k+"px; display: inline-block; box-sizing: border-box; } .point { background-color: #EEE; width: 20px; height: 20px; float: left; line-height: 20px; font-size: 12px; text-align: center; padding: 1px; position: relative; overflow: hidden; } .point > .cir { width: 20px; height: 20px; border-radius: 10px; z-index: 10; position: absolute; top: 1px; left: 1px; } .point.active>.cir:hover { background-color: #FFF; cursor: pointer; } .p1 > .cir,.p1.active > .cir:hover { background-color: #E6A1A1; cursor: default; box-shadow: inset 0 0 10px rgba(200, 40, 40, 0.6); } .p2 > .cir,.p2.active > .cir:hover { background-color: #A1A1E6; cursor: default; box-shadow: inset 0 0 10px rgba(40, 40, 200, 0.6); } .bo { display: none; position: absolute; width: 15px; height: 15px; box-shadow: inset 0 0 2px #111; } .l1 { display: block; top: -4px; left: -4px; } .l2 { display: block; top: -4px; right: -4px; } .l3 { display: block; bottom: -4px; left: -4px; } .l4 { display: block; bottom: -4px; right: -4px; } .p1 > .cir.c3,.p1 > .cir.c3:hover { background-color: #E65C5C; } .p1 > .cir.c4,.p1 > .cir.c4:hover { background-color: #E62E2E; } .p1 > .cir.c5,.p1 > .cir.c5:hover { background-color: #FE0101; } .p2 > .cir.c3,.p2 > .cir.c3:hover { background-color: #5C5CE6; } .p2 > .cir.c4,.p2 > .cir.c4:hover { background-color: #2E2EE6; } .p2 > .cir.c5,.p2 > .cir.c5:hover { background-color: #0101FE; }",r.innerHTML=".point.active { background-color: "+((w-1)%2?"#E6E6FF":"#FFE6E6")+";}";for(var s=0;k>s;s++){for(var d=document.createElement("div"),p=0;x>p;p++){var u=document.createElement("div");u.dataset.p=p+s*x,u.className="point active",u.dataset.x=p,u.dataset.y=s,u.addEventListener("click",f),u.appendChild(document.createElement("div")),u.firstChild.className="cir",u.appendChild(document.createElement("div")),u.lastChild.className="bo"+(0===p||0===s?"":" l1"),u.appendChild(document.createElement("div")),u.lastChild.className="bo"+(p===x-1||0===s?"":" l2"),u.appendChild(document.createElement("div")),u.lastChild.className="bo"+(0===p||s===k-1?"":" l3"),u.appendChild(document.createElement("div")),u.lastChild.className="bo"+(p===x-1||s===k-1?"":" l4"),d.appendChild(u)}d.appendChild(document.createElement("div")),d.lastChild.style.clear="both",o.appendChild(d)}o.onmousedown=function(e){e.preventDefault()},e?e.appendChild(o):document.body.appendChild(o),document.body.appendChild(i),document.body.appendChild(r)}e=void 0===e?{}:{oldP5g:e};var m,v=Math.round(1e7*Math.random()),b=5,y=32,E=32,x=y,k=E,C=x*k,F=new Uint16Array(C),N=new Uint16Array(C),w=1,L=!1,U=new Uint16Array(C),D={U:{x:0,y:-1},UR:{x:1,y:-1},R:{x:1,y:0},RD:{x:1,y:1},D:{x:0,y:1},DL:{x:-1,y:1},L:{x:-1,y:0},LU:{x:-1,y:-1}},M=["LU","L","UR","U"],A=["RD","R","DL","D"],R=M.concat(A);return D.U.r=D.D,D.UR.r=D.DL,D.R.r=D.L,D.RD.r=D.LU,D.D.r=D.U,D.DL.r=D.UR,D.L.r=D.R,D.LU.r=D.RD,e.place=t,e.reset=h,e.save=s,e.load=d,e.redo=p,e.refresh_dom=u,e.create_dom=g,e}(P5g);