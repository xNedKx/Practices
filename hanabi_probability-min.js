window.onload=function(){!function(e){function t(t,n){function l(e){e.preventDefault(),e.stopPropagation(),r.classList.remove("s"+a),a+1===2&&c(t)[0]+1!==n?a=3:a+1===4?a=0:a++,q(t),r.classList.add("s"+a),S(),P()}var a=0,r=e.document.createElement("div");r.className="card "+t+" n"+n+" s0",r.dataset.color=t,r.dataset.number=n,r.appendChild(e.document.createElement("div")),r.lastChild.className="card-mask",r.addEventListener("click",l),U(this,"color",{enumerable:!0,value:t}),U(this,"number",{enumerable:!0,value:n}),U(this,"status",{enumerable:!0,get:function(){return a},set:function(e){"number"==typeof e&&e>=0&&4>e&&(r.classList.remove("s"+a),r.classList.add("s"+(a=e)))}}),U(this,"append",{enumerable:!0,value:function(e){e.appendChild(r)}}),U(this,"detach",{enumerable:!0,value:function(){r.parentNode.removeChild(r)}}),U(this,"last_hint",{enumerable:!0,value:function(e){e?r.classList.add("last"):r.classList.remove("last")}})}function n(e){var n=[],l=[];switch(e){case"r10":n=z.concat(F.rainbow10);break;case"r5":n=z.concat(F.rainbow5);break;default:n=z}n.forEach(function(e){var n=[];e.numbers.forEach(function(l){for(var a=0;a<l.n;a++)n.push(new t(e.color,l.k))}),l.push(n)}),t.cards=l,t.counts={},t.counts.all=l.reduce(function(e,n){return e+(t.counts[n[0].color]=n.length)},0);for(var a=1;6>a;a++)t.counts[a]=l.reduce(function(e,t){return e+t.filter(function(e){return e.number===a}).length},0);return l}function l(n){t.cards.forEach(function(t){n.appendChild(e.document.createElement("div")),n.lastChild.className="cards_row_wrap",n.lastChild.appendChild(e.document.createElement("div")),n.lastChild.lastChild.className="cards_row "+t[0].color,t.forEach(function(e){e.append(n.lastChild.lastChild)})})}function a(e){for(t.cards.forEach(function(e){e.forEach(function(e){e.detach()})});e.children.length;)e.removeChild(e.lastElementChild)}function r(){return t.cards.reduce(function(e,t){return e+t.filter(function(e){return e.status<2}).length},0)}function s(e){var n=t.cards.filter(function(t){return t[0].color===e});return n.length?n[0].filter(function(e){return e.status<2}).length:0}function u(e){return t.cards.reduce(function(t,n){return t+n.filter(function(t){return t.number===e&&t.status<2}).length},0)}function o(e,n){var l=t.cards.filter(function(t){return t[0].color===e});return l.length?l[0].filter(function(e){return e.number===n&&e.status<2}).length:0}function c(e){var n=t.cards.filter(function(t){return t[0].color===e});return(n.length?n:t.cards).map(function(e){for(var t=0,n=0;n<e.length;n++)if(2===e[n].status&&t===e[n].number-1)t=e[n].number;else if(e[n]>t+1)break;return t})}function i(){var e=c();return t.cards.reduce(function(t,n,l){return t+n.filter(function(t){return t.number===e[l]+1&&t.status<2}).length},0)}function d(e){var n=c(e)[0]+1,l=t.cards.filter(function(t){return t[0].color===e});return l.length?l[0].filter(function(e){return e.number===n&&e.status<2}).length:0}function f(e){var n=c();return t.cards.reduce(function(t,l,a){return t+l.filter(function(t){return t.number===n[a]+1&&t.number===e&&t.status<2}).length},0)}function m(e,n){var l=c(e)[0]+1,a=t.cards.filter(function(t){return t[0].color===e});return a.length?a[0].filter(function(e){return e.number===l&&e.number===n&&e.status<2}).length:0}function b(){return t.cards.map(function(e){for(var t=5,n=0,l=e.length-1;l>=0;l--)e[l].status<3&&n++,(l&&e[l-1].number||0)<e[l].number&&(n?n=0:t=e[l].number-1);return t})}function h(){var e=c(),n=b();return t.cards.map(function(t,l){for(var a=[],r=0,s=t.length-1;s>=0;s--)(t[s].number<=n[l]||t[s].number>e[l])&&(t[s].status<2?r++:2===t[s].status&&(r+=2),(s&&t[s-1].number||0)<t[s].number&&(1===r&&a.push(t[s].number),r=0));return a})}function p(){return h().reduce(function(e,t){return e+t.length},0)}function C(e){var n=h().filter(function(n,l){return t.cards[l][0].color===e});return n.length?n[0].length:0}function v(e){return h().reduce(function(t,n){return t+n.filter(function(t){return t===e}).length},0)}function y(e,n){return h().filter(function(l,a){return t.cards[a][0].color===e&&l.filter(function(e){return e===n}).length}).length}function _(){var e=c();return h().reduce(function(t,n,l){return t+n.filter(function(t){return t===e[l]+1}).length},0)}function g(e){var n=c(e),l=h().filter(function(n,l){return t.cards[l][0].color===e});return l.length?l[0].filter(function(e){return e===n[0]+1}).length:0}function E(e){var t=c();return h().reduce(function(n,l,a){return n+l.filter(function(n){return n===e&&n===t[a]+1}).length},0)}function k(e,n){var l=c(e),a=h().filter(function(n,l){return t.cards[l][0].color===e});return a.length?a[0].filter(function(e){return e===n&&e===l[0]+1}).length:0}function N(){var e=r(),t=i(),n=p(),l=_(),a=e-t-n+l;return{left:e,playable:t,safe:a,last:n,last_playable:l}}function B(e){var t=s(e),n=d(e),l=C(e),a=g(e),r=t-n-l+a;return{left:t,playable:n,safe:r,last:l,last_playable:a}}function x(e){var t=u(e),n=f(e),l=v(e),a=E(e),r=t-n-l+a;return{left:t,playable:n,safe:r,last:l,last_playable:a}}function w(e,t){var n=o(e,t),l=m(e,t),a=y(e,t),r=k(e,t),s=n-l-a+r;return{left:n,playable:l,safe:s,last:a,last_playable:r}}function L(){var e=N();return e.left>0?{playable:Math.round(e.playable/e.left*1e4)/100+"%",safe:Math.round(e.safe/e.left*1e4)/100+"%",last:Math.round(e.last/e.left*1e4)/100+"%"}:{playable:0,safe:0,last:0}}function M(e){var t=B(e);return t.left>0?{playable:Math.round(t.playable/t.left*1e4)/100+"%",safe:Math.round(t.safe/t.left*1e4)/100+"%",last:Math.round(t.last/t.left*1e4)/100+"%"}:{playable:0,safe:0,last:0}}function I(e){var t=x(e);return t.left>0?{playable:Math.round(t.playable/t.left*1e4)/100+"%",safe:Math.round(t.safe/t.left*1e4)/100+"%",last:Math.round(t.last/t.left*1e4)/100+"%"}:{playable:0,safe:0,last:0}}function A(e,t){var n=w(e,t);return n.left>0?{playable:Math.round(n.playable/n.left*1e4)/100+"%",safe:Math.round(n.safe/n.left*1e4)/100+"%",last:Math.round(n.last/n.left*1e4)/100+"%"}:{playable:0,safe:0,last:0}}function O(){return{all:N(),colors:t.cards.reduce(function(e,t){return e[t[0].color]=B(t[0].color),e},{}),numbers:[1,2,3,4,5].reduce(function(e,t){return e[t]=x(t),e},{})}}function j(){return{all:L(),colors:t.cards.reduce(function(e,t){return e[t[0].color]=M(t[0].color),e},{}),numbers:[1,2,3,4,5].reduce(function(e,t){return e[t]=I(t),e},{})}}function q(e){var n=c(e),l=t.cards.filter(function(t){return t[0].color===e});if(l.length)for(var a=l[0],r=a.length-1;r>=0;r--)if(2===a[r].status&&a[r].number>n[0])a[r].status=3;else if(a[r].number<=n[0])break}function S(){for(var t=O(),n=e.document.querySelectorAll(".probability.all"),l=0;l<n.length;l++)n[l].getElementsByClassName("left")[0].textContent=t.all.left,n[l].getElementsByClassName("playable")[0].textContent=t.all.playable+"/"+t.all.left,n[l].getElementsByClassName("safe")[0].textContent=t.all.safe+"/"+t.all.left,n[l].getElementsByClassName("last")[0].textContent=t.all.last+"/"+t.all.left,n[l].getElementsByClassName("last-playable")[0].textContent=t.all.last_playable;Object.keys(t.colors).forEach(function(l){n=e.document.querySelectorAll(".probability.color."+l);for(var a=0;a<n.length;a++)n[a].getElementsByClassName("left")[0].textContent=t.colors[l].left,n[a].getElementsByClassName("playable")[0].textContent=t.colors[l].playable+"/"+t.colors[l].left,n[a].getElementsByClassName("safe")[0].textContent=t.colors[l].safe+"/"+t.colors[l].left,n[a].getElementsByClassName("last")[0].textContent=t.colors[l].last+"/"+t.colors[l].left,n[a].getElementsByClassName("last-playable")[0].textContent=t.colors[l].last_playable}),Object.keys(t.numbers).forEach(function(l){n=e.document.querySelectorAll(".probability.number.n"+l);for(var a=0;a<n.length;a++)n[a].getElementsByClassName("left")[0].textContent=t.numbers[l].left,n[a].getElementsByClassName("playable")[0].textContent=t.numbers[l].playable+"/"+t.numbers[l].left,n[a].getElementsByClassName("safe")[0].textContent=t.numbers[l].safe+"/"+t.numbers[l].left,n[a].getElementsByClassName("last")[0].textContent=t.numbers[l].last+"/"+t.numbers[l].left,n[a].getElementsByClassName("last-playable")[0].textContent=t.numbers[l].last_playable})}function P(){var e=h();t.cards.forEach(function(t,n){t.forEach(function(t){t.last_hint(t.status<2&&-1!==e[n].indexOf(t.number)?!0:!1)})})}function D(n){for(;n.children.length;)n.removeChild(n.lastElementChild);var l=e.document.createElement("div");l.className="probability all",l.appendChild(e.document.createElement("div")),l.lastChild.className="title",l.lastChild.textContent="ALL",l.appendChild(e.document.createElement("div")),l.lastChild.className="left",l.appendChild(e.document.createElement("div")),l.lastChild.className="playable",l.appendChild(e.document.createElement("div")),l.lastChild.className="safe",l.appendChild(e.document.createElement("div")),l.lastChild.className="last",l.appendChild(e.document.createElement("div")),l.lastChild.className="last-playable",n.appendChild(l),t.cards.forEach(function(t){var l=e.document.createElement("div");l.className="probability color "+t[0].color,l.appendChild(e.document.createElement("div")),l.lastChild.className="title",l.lastChild.textContent=t[0].color.toUpperCase(),l.appendChild(e.document.createElement("div")),l.lastChild.className="left",l.appendChild(e.document.createElement("div")),l.lastChild.className="playable",l.appendChild(e.document.createElement("div")),l.lastChild.className="safe",l.appendChild(e.document.createElement("div")),l.lastChild.className="last",l.appendChild(e.document.createElement("div")),l.lastChild.className="last-playable",n.appendChild(l)});for(var a=1;6>a;a++){var r=e.document.createElement("div");r.className="probability number n"+a,r.appendChild(e.document.createElement("div")),r.lastChild.className="title",r.lastChild.textContent="> "+a+" <",r.appendChild(e.document.createElement("div")),r.lastChild.className="left",r.appendChild(e.document.createElement("div")),r.lastChild.className="playable",r.appendChild(e.document.createElement("div")),r.lastChild.className="safe",r.appendChild(e.document.createElement("div")),r.lastChild.className="last",r.appendChild(e.document.createElement("div")),r.lastChild.className="last-playable",n.appendChild(r)}}var U=Object.defineProperty,z=[{color:"red",numbers:[{k:1,n:3},{k:2,n:2},{k:3,n:2},{k:4,n:2},{k:5,n:1}]},{color:"blue",numbers:[{k:1,n:3},{k:2,n:2},{k:3,n:2},{k:4,n:2},{k:5,n:1}]},{color:"green",numbers:[{k:1,n:3},{k:2,n:2},{k:3,n:2},{k:4,n:2},{k:5,n:1}]},{color:"yellow",numbers:[{k:1,n:3},{k:2,n:2},{k:3,n:2},{k:4,n:2},{k:5,n:1}]},{color:"white",numbers:[{k:1,n:3},{k:2,n:2},{k:3,n:2},{k:4,n:2},{k:5,n:1}]}],F={rainbow10:{color:"rainbow",numbers:[{k:1,n:3},{k:2,n:2},{k:3,n:2},{k:4,n:2},{k:5,n:1}]},rainbow5:{color:"rainbow",numbers:[{k:1,n:1},{k:2,n:1},{k:3,n:1},{k:4,n:1},{k:5,n:1}]}};t.cards=[],t.get_current_number=c,t.get_max_available_number=b,t.get_last_array=h,t.count_available=r,t.count_available_color=s,t.count_available_number=u,t.count_available_card=o,t.count_playable=i,t.count_playable_color=d,t.count_playable_number=f,t.count_playable_card=m,t.count_last=p,t.count_last_color=C,t.count_last_number=v,t.count_last_card=y,t.count_last_playable=_,t.count_last_playable_color=g,t.count_last_playable_number=E,t.count_last_playable_card=k,t.probability=N,t.probability_color=B,t.probability_number=x,t.probability_card=w,t.prob_percent=L,t.prob_percent_color=M,t.prob_percent_number=I,t.prob_percent_card=A,t.probability_all=O,t.prob_percent_all=j,t.refresh_ui_prob=S,t.refresh_ui_last=P,U(t,"reset",{numerable:!0,value:function(t){a(e.document.getElementById("main")),n(t),l(e.document.getElementById("main")),D(e.document.getElementById("content")),S(),P()}}),t.reset(),e.document.getElementById("n").addEventListener("click",t.reset.bind(null,null)),e.document.getElementById("r5").addEventListener("click",t.reset.bind(null,"r5")),e.document.getElementById("r10").addEventListener("click",t.reset.bind(null,"r10")),e.Card=t}(window)};